# 源代码鉴别材料（前30页）

软件名称：AI语文助手 - 体育生语文基础智能辅导系统
软件版本：V3.0.0

---

## 第 1 页

**文件名：src/main.jsx**

```javascript
import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App.jsx'
import './index.css'
import { ConfigProvider } from 'antd'
import zhCN from 'antd/locale/zh_CN'

ReactDOM.createRoot(document.getElementById('root')).render(
  <React.StrictMode>
    <ConfigProvider locale={zhCN}>
      <App />
    </ConfigProvider>
  </React.StrictMode>,
)
```

**文件名：src/App.jsx**

```javascript
import React, { useState, useEffect } from 'react'
import { BrowserRouter as Router, Routes, Route, Navigate } from 'react-router-dom'
import { Layout, Menu, message } from 'antd'
import {
  HomeOutlined,
  BookOutlined,
  LineChartOutlined,
  BarChartOutlined,
  FileTextOutlined,
  UserOutlined,
  LogoutOutlined,
  LoginOutlined
} from '@ant-design/icons'
import { authService } from './services/authService'
import Home from './pages/Home'
import Exercise from './pages/Exercise'
import StudyReport from './pages/StudyReport'
import StudyAnalysis from './pages/StudyAnalysis'
import StudyRecord from './pages/StudyRecord'
import Profile from './pages/Profile'
import Vocabulary from './pages/Vocabulary'
import Literature from './pages/Literature'
import Pinyin from './pages/Pinyin'
import Correction from './pages/Correction'
import Chat from './pages/Chat'
import Idiom from './pages/Idiom'
import ExerciseDetail from './pages/ExerciseDetail'
import MockExam from './pages/MockExam'
import Login from './pages/Login'
import './App.css'

const { Header, Content, Footer } = Layout

// 路由守卫组件
function PrivateRoute({ children }) {
  const isAuthenticated = authService.isLoggedIn();

  return isAuthenticated ? children : <Navigate to="/login" replace />;
}
```

---

## 第 2 页

**文件名：src/App.jsx（续）**

```javascript
function App() {
  const [current, setCurrent] = useState('home')
  const [isLogin, setIsLogin] = useState(false)
  const [user, setUser] = useState(null)
  const [loading, setLoading] = useState(true)

  // 检查登录状态
  useEffect(() => {
    const checkLoginStatus = async () => {
      try {
        const loggedIn = authService.isLoggedIn();
        if (loggedIn) {
          const currentUser = authService.getStoredUser();
          if (currentUser) {
            setIsLogin(true);
            setUser(currentUser);
          } else {
            // 如果有token但没有用户信息，尝试获取
            const result = await authService.getCurrentUser();
            if (result.success) {
              setIsLogin(true);
              setUser(result.user);
            }
          }
        }
      } catch (error) {
        console.error('检查登录状态失败:', error);
      } finally {
        setLoading(false);
      }
    };

    checkLoginStatus();
  }, []);

  const handleMenuClick = (e) => {
    if (e.key === 'logout') {
      handleLogout();
      return;
    }

    setCurrent(e.key);
    const pathMap = {
      'home': '/home',
      'vocabulary': '/vocabulary',
      'literature': '/literature',
      'idiom': '/idiom',
      'exercise': '/exercise',
      'study-record': '/study-record',
      'study-report': '/study-report',
      'study-analysis': '/study-analysis',
      'profile': '/profile',
      'chat': '/chat'
    };

    if (pathMap[e.key]) {
      window.location.href = pathMap[e.key];
    }
  };

  const handleLogout = async () => {
    try {
      const result = await authService.logout();
      if (result.success) {
        message.success('退出登录成功');
        setIsLogin(false);
        setUser(null);
        window.location.href = '/login';
      }
    } catch (error) {
      message.error('退出登录失败');
      console.error('Logout error:', error);
    }
  };
```

---

## 第 3 页

**文件名：src/App.jsx（续）**

```javascript
  // 显示加载状态
  if (loading) {
    return (
      <div style={{
        height: '100vh',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        fontSize: '16px'
      }}>
        加载中...
      </div>
    );
  }

  return (
    <Router>
      <Layout className="layout">
        <Header className="header">
          <div className="logo">AI语文助手</div>
          {isLogin && (
            <Menu
              theme="dark"
              mode="horizontal"
              selectedKeys={[current]}
              onClick={handleMenuClick}
              className="header-menu"
            >
              <Menu.Item key="home" icon={<HomeOutlined />}>
                首页
              </Menu.Item>
              <Menu.Item key="vocabulary" icon={<BookOutlined />}>
                词语学习
              </Menu.Item>
              <Menu.Item key="literature" icon={<BookOutlined />}>
                古诗词学习
              </Menu.Item>
              <Menu.Item key="idiom" icon={<BookOutlined />}>
                熟语习语
              </Menu.Item>
              <Menu.Item key="exercise" icon={<FileTextOutlined />}>
                练习中心
              </Menu.Item>
              <Menu.Item key="chat" icon={<FileTextOutlined />}>
                AI聊天
              </Menu.Item>
              <Menu.Item key="study-record" icon={<LineChartOutlined />}>
                学习记录
              </Menu.Item>
              <Menu.Item key="study-report" icon={<BarChartOutlined />}>
                学习报告
              </Menu.Item>
              <Menu.Item key="study-analysis" icon={<BarChartOutlined />}>
                学习分析
              </Menu.Item>
              <Menu.Item key="profile" icon={<UserOutlined />}>
                个人资料
              </Menu.Item>
              <Menu.Item key="logout" icon={<LogoutOutlined />}>
                退出登录
              </Menu.Item>
            </Menu>
          )}
        </Header>

        <Content className="content">
          <div className="container">
            <Routes>
              {/* 登录页面路由 */}
              <Route path="/login" element={<Login />} />

              {/* 需要登录才能访问的路由 */}
              <Route path="/" element={
                <PrivateRoute>
                  <Home />
                </PrivateRoute>
              } />
```

---

## 第 4 页

**文件名：src/App.jsx（续）**

```javascript
              <Route path="/home" element={
                <PrivateRoute>
                  <Home />
                </PrivateRoute>
              } />
              <Route path="/exercise" element={
                <PrivateRoute>
                  <Exercise />
                </PrivateRoute>
              } />
              <Route path="/exercise-detail/:id" element={
                <PrivateRoute>
                  <ExerciseDetail />
                </PrivateRoute>
              } />
              <Route path="/study-report" element={
                <PrivateRoute>
                  <StudyReport />
                </PrivateRoute>
              } />
              <Route path="/report" element={
                <PrivateRoute>
                  <StudyReport />
                </PrivateRoute>
              } />
              <Route path="/study-analysis" element={
                <PrivateRoute>
                  <StudyAnalysis />
                </PrivateRoute>
              } />
              <Route path="/study-record" element={
                <PrivateRoute>
                  <StudyRecord />
                </PrivateRoute>
              } />
              <Route path="/profile" element={
                <PrivateRoute>
                  <Profile />
                </PrivateRoute>
              } />
              <Route path="/vocabulary" element={
                <PrivateRoute>
                  <Vocabulary />
                </PrivateRoute>
              } />
              <Route path="/literature" element={
                <PrivateRoute>
                  <Literature />
                </PrivateRoute>
              } />
              <Route path="/poetry" element={
                <PrivateRoute>
                  <Literature />
                </PrivateRoute>
              } />
```

---

## 第 5 页

**文件名：src/App.jsx（续）**

```javascript
              <Route path="/pinyin" element={
                <PrivateRoute>
                  <Pinyin />
                </PrivateRoute>
              } />
              <Route path="/correction" element={
                <PrivateRoute>
                  <Correction />
                </PrivateRoute>
              } />
              <Route path="/chat" element={
                <PrivateRoute>
                  <Chat />
                </PrivateRoute>
              } />
              <Route path="/mock-exam" element={
                <PrivateRoute>
                  <MockExam />
                </PrivateRoute>
              } />
              <Route path="/idiom" element={
                <PrivateRoute>
                  <Idiom />
                </PrivateRoute>
              } />

              {/* 默认重定向到首页 */}
              <Route path="*" element={<Navigate to="/" replace />} />
            </Routes>
          </div>
        </Content>

        <Footer className="footer">
          <div className="footer-content">
            <div className="contact-info">
              <p>联系我们：insistgang@163.com</p>
              <p>版本：v3.0.0</p>
            </div>
            <div className="copyright">
              © 2025 AI语文助手 - 体育生语文基础智能辅导系统
            </div>
          </div>
        </Footer>
      </Layout>
    </Router>
  )
}

export default App
```

**文件名：src/context/AuthContext.jsx**

```javascript
import React, { createContext, useContext, useState, useEffect } from 'react';
import { authService } from '../services/authService';
import { message } from 'antd';

const AuthContext = createContext(null);

export const AuthProvider = ({ children }) => {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const checkLoginStatus = async () => {
      try {
        const loggedIn = authService.isLoggedIn();
        if (loggedIn) {
          const currentUser = authService.getStoredUser();
```

---

## 第 6 页

**文件名：src/context/AuthContext.jsx（续）**

```javascript
          if (currentUser) {
            setUser(currentUser);
          } else {
            // 如果有token但没有用户信息，尝试获取
            const result = await authService.getCurrentUser();
            if (result.success) {
              setUser(result.user);
            }
          }
        }
      } catch (error) {
        console.error('检查登录状态失败:', error);
      } finally {
        setLoading(false);
      }
    };

    checkLoginStatus();
  }, []);

  const login = async (username, password) => {
    try {
      const result = await authService.login(username, password);

      if (result.success) {
        setUser(result.user);
        message.success('登录成功！');
        return { success: true };
      } else {
        message.error(result.message || '登录失败');
        return { success: false, message: result.message };
      }
    } catch (error) {
      message.error('登录失败，请稍后重试');
      console.error('Login error:', error);
      return { success: false, message: '登录失败，请稍后重试' };
    }
  };

  const register = async (userData) => {
    try {
      const result = await authService.register(userData);

      if (result.success) {
        setUser(result.user);
        message.success('注册成功！');
        return { success: true };
      } else {
        message.error(result.message || '注册失败');
        return { success: false, message: result.message };
      }
    } catch (error) {
      message.error('注册失败，请稍后重试');
      console.error('Register error:', error);
      return { success: false, message: '注册失败，请稍后重试' };
    }
  };
```

---

## 第 7 页

**文件名：src/context/AuthContext.jsx（续）**

```javascript
  const logout = async () => {
    try {
      const result = await authService.logout();
      if (result.success) {
        setUser(null);
        message.success('退出登录成功');
        return { success: true };
      }
    } catch (error) {
      message.error('退出登录失败');
      console.error('Logout error:', error);
      // 即使接口调用失败，也清除本地状态
      setUser(null);
      return { success: true };
    }
  };

  const updateProfile = async (userData) => {
    try {
      const result = await authService.updateProfile(userData);

      if (result.success) {
        setUser(result.user);
        message.success('更新成功！');
        return { success: true, user: result.user };
      } else {
        message.error(result.message || '更新失败');
        return { success: false, message: result.message };
      }
    } catch (error) {
      message.error('更新失败，请稍后重试');
      console.error('Update profile error:', error);
      return { success: false, message: '更新失败，请稍后重试' };
    }
  };

  const value = {
    user,
    login,
    register,
    logout,
    updateProfile,
    loading,
    isLoggedIn: !!user,
    isTokenValid: authService.isTokenValid()
  };

  return (
    <AuthContext.Provider value={value}>
      {children}
    </AuthContext.Provider>
  );
};

export const useAuth = () => {
  const context = useContext(AuthContext);
  if (!context) {
    throw new Error('useAuth must be used within an AuthProvider');
  }
  return context;
};

export default AuthContext;
```

---

## 第 8 页

**文件名：src/services/api.js**

```javascript
import axios from 'axios';

// 创建 axios 实例
const api = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL || '/api',
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json'
  }
});

// 请求拦截器 - 自动携带 JWT Token
api.interceptors.request.use(
  (config) => {
    // 从 localStorage 获取 token
    const token = localStorage.getItem('authToken');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => {
    console.error('请求拦截器错误:', error);
    return Promise.reject(error);
  }
);

// 响应拦截器 - 处理错误
api.interceptors.response.use(
  (response) => {
    return response.data;
  },
  (error) => {
    // 处理 401 未授权错误
    if (error.response?.status === 401) {
      // 清除本地存储的认证信息
      localStorage.removeItem('authToken');
      localStorage.removeItem('currentUser');

      // 跳转到登录页
      window.location.href = '/login';
    }

    // 返回错误信息
    const errorMessage = error.response?.data?.message || error.message || '请求失败';
    console.error('API 请求错误:', errorMessage);

    return Promise.reject(error);
  }
);

export default api;
```

**文件名：src/services/authService.js**

```javascript
import api from './api';

class AuthService {
  // 用户登录
  async login(username, password) {
    try {
      const response = await api.post('/auth/login', {
        username,
        password
      });

      if (response.success) {
        // 保存 token 和用户信息
        localStorage.setItem('authToken', response.token);
        localStorage.setItem('currentUser', JSON.stringify(response.user));

        return {
          success: true,
          user: response.user
        };
      }

      return {
        success: false,
        message: response.message || '登录失败'
      };
    } catch (error) {
      return {
```

---

## 第 9 页

**文件名：src/services/authService.js（续）**

```javascript
        success: false,
        message: error.response?.data?.message || error.message || '登录失败，请稍后重试'
      };
    }
  }

  // 用户注册
  async register(userData) {
    try {
      const response = await api.post('/auth/register', userData);

      if (response.success) {
        // 保存 token 和用户信息
        localStorage.setItem('authToken', response.token);
        localStorage.setItem('currentUser', JSON.stringify(response.user));

        return {
          success: true,
          user: response.user
        };
      }

      return {
        success: false,
        message: response.message || '注册失败'
      };
    } catch (error) {
      return {
        success: false,
        message: error.response?.data?.message || error.message || '注册失败，请稍后重试'
      };
    }
  }

  // 用户登出
  async logout() {
    try {
      // 调用后端登出接口（可选）
      // await api.post('/auth/logout');

      // 清除本地存储
      localStorage.removeItem('authToken');
      localStorage.removeItem('currentUser');

      return {
        success: true,
        message: '登出成功'
      };
    } catch (error) {
      // 即使接口调用失败，也清除本地存储
      localStorage.removeItem('authToken');
      localStorage.removeItem('currentUser');

      return {
        success: true,
        message: '登出成功'
      };
    }
  }

  // 获取当前用户信息
  async getCurrentUser() {
    try {
      const response = await api.get('/auth/profile');

      if (response.success) {
        // 更新本地存储的用户信息
        localStorage.setItem('currentUser', JSON.stringify(response.user));

        return {
          success: true,
          user: response.user
        };
      }

      return {
        success: false,
        message: response.message || '获取用户信息失败'
      };
    } catch (error) {
```

---

## 第 10 页

**文件名：src/services/authService.js（续）**

```javascript
      return {
        success: false,
        message: error.response?.data?.message || error.message || '获取用户信息失败'
      };
    }
  }

  // 更新用户信息
  async updateProfile(userData) {
    try {
      const response = await api.put('/auth/profile', userData);

      if (response.success) {
        // 更新本地存储的用户信息
        localStorage.setItem('currentUser', JSON.stringify(response.user));

        return {
          success: true,
          user: response.user,
          message: response.message || '更新成功'
        };
      }

      return {
        success: false,
        message: response.message || '更新失败'
      };
    } catch (error) {
      return {
        success: false,
        message: error.response?.data?.message || error.message || '更新失败，请稍后重试'
      };
    }
  }

  // 修改密码
  async changePassword(oldPassword, newPassword) {
    try {
      const response = await api.put('/auth/password', {
        oldPassword,
        newPassword
      });

      return {
        success: true,
        message: response.message || '密码修改成功'
      };
    } catch (error) {
      return {
        success: false,
        message: error.response?.data?.message || error.message || '密码修改失败，请稍后重试'
      };
    }
  }

  // 检查用户是否已登录
  isLoggedIn() {
    const token = localStorage.getItem('authToken');
    const user = localStorage.getItem('currentUser');
    return !!(token && user);
  }

  // 获取当前登录用户（从本地存储）
  getStoredUser() {
    const userStr = localStorage.getItem('currentUser');
    if (userStr) {
      try {
        return JSON.parse(userStr);
      } catch (error) {
        console.error('解析用户信息失败:', error);
        return null;
      }
    }
    return null;
  }

  // 获取认证 Token
  getToken() {
    return localStorage.getItem('authToken');
  }

  // 验证 Token 是否有效（简单验证，实际有效性由后端判断）
  isTokenValid() {
    const token = this.getToken();
    if (!token) return false;

    try {
```

---

## 第 11 页

**文件名：src/services/authService.js（续）**

```javascript
      // 解析 JWT Token 的 payload 部分
      const payload = JSON.parse(atob(token.split('.')[1]));
      const currentTime = Date.now() / 1000;

      // 检查是否过期
      return payload.exp > currentTime;
    } catch (error) {
      console.error('Token 验证失败:', error);
      return false;
    }
  }

  // 刷新用户信息
  async refreshUserInfo() {
    if (this.isLoggedIn()) {
      return await this.getCurrentUser();
    }
    return { success: false, message: '用户未登录' };
  }
}

// 创建并导出 authService 实例
export const authService = new AuthService();

export default authService;
```

**文件名：src/services/studyRecordService.js**

```javascript
// 学习记录服务 - 提供学习记录管理、统计等功能
import api from './api';

class StudyRecordService {
  constructor() {
    // 服务配置
    this.config = {
      timeout: 10000,
      cacheEnabled: true,
      cacheTTL: 300000, // 5分钟缓存
    };

    // 初始化缓存
    this.cache = new Map();
  }

  // 初始化服务
  init() {
    console.log('StudyRecordService initialized');
  }

  // 获取学习记录
  async getStudyRecords(filters = {}) {
    try {
      // 构建查询参数
      const params = {
        limit: filters.pageSize || 20,
        offset: filters.page ? (filters.page - 1) * (filters.pageSize || 20) : 0,
        type: filters.type === 'all' ? undefined : filters.type,
        startDate: filters.startDate,
        endDate: filters.endDate
      };

      const response = await api.get('/study/records', { params });

      if (response.success) {
```

---

## 第 12 页

**文件名：src/services/studyRecordService.js（续）**

```javascript
        // 转换数据格式以兼容前端
        const records = response.data.map(record => ({
          id: record.id,
          type: record.type,
          title: this.getRecordTitle(record),
          studyDate: new Date(record.createdAt).toLocaleDateString('zh-CN'),
          duration: record.duration,
          durationText: this.formatDuration(record.duration),
          score: record.score,
          totalQuestions: record.totalQuestions,
          correctAnswers: record.correctAnswers,
          completionRate: record.totalQuestions ? Math.round((record.correctAnswers / record.totalQuestions) * 100) : 100,
          content: record.content
        }));

        return {
          data: records,
          total: records.length,
          page: filters.page || 1,
          pageSize: filters.pageSize || 20
        };
      }

      return {
        data: [],
        total: 0,
        page: 1,
        pageSize: 20
      };
    } catch (error) {
      console.error('获取学习记录失败:', error);
      return {
        data: [],
        total: 0,
        page: 1,
        pageSize: 20
      };
    }
  }

  // 添加学习记录
  async addStudyRecord(recordData) {
    try {
      const response = await api.post('/study/record', recordData);

      if (response.success) {
        // 清除相关缓存
        this.clearCacheByPrefix('records_');
        this.clearCacheByPrefix('statistics_');

        return {
          success: true,
          data: response.data
        };
      }

      return {
        success: false,
        message: response.message || '添加失败'
      };
    } catch (error) {
      console.error('添加学习记录失败:', error);
      return {
        success: false,
        message: error.response?.data?.message || '添加失败，请稍后重试'
      };
    }
  }

  // 批量添加学习记录
  async addStudyRecords(records) {
    try {
      const response = await api.post('/study/records', {
        records
      });

      if (response.success) {
```

---

## 第 13 页

**文件名：src/services/studyRecordService.js（续）**

```javascript
        // 清除相关缓存
        this.clearCacheByPrefix('records_');
        this.clearCacheByPrefix('statistics_');

        return {
          success: true,
          data: response.data
        };
      }

      return {
        success: false,
        message: response.message || '批量添加失败'
      };
    } catch (error) {
      console.error('批量添加学习记录失败:', error);
      return {
        success: false,
        message: error.response?.data?.message || '批量添加失败，请稍后重试'
      };
    }
  }

  // 删除学习记录
  async deleteStudyRecord(recordId) {
    try {
      const response = await api.delete(`/study/record/${recordId}`);

      if (response.success) {
        // 清除相关缓存
        this.clearCacheByPrefix('records_');
        this.clearCacheByPrefix('statistics_');

        return {
          success: true,
          message: response.message || '删除成功'
        };
      }

      return {
        success: false,
        message: response.message || '删除失败'
      };
    } catch (error) {
      console.error('删除学习记录失败:', error);
      return {
        success: false,
        message: error.response?.data?.message || '删除失败，请稍后重试'
      };
    }
  }

  // 获取学习统计
  async getStudyStatistics(days = 30) {
    try {
      // 构建缓存键
      const cacheKey = `statistics_${days}`;

      // 检查缓存
      if (this.config.cacheEnabled) {
        const cachedResult = this.getFromCache(cacheKey);
        if (cachedResult) {
          return cachedResult;
        }
      }

      const response = await api.get('/study/statistics', {
        params: { days }
      });

      if (response.success) {
        const statistics = response.data;

        // 转换数据格式
        const formattedStats = {
          totalStudyTime: Math.round(statistics.totalDuration / 60), // 转换为分钟
          studyDays: statistics.studyDays,
```

---

## 第 14 页

**文件名：src/services/studyRecordService.js（续）**

```javascript
          averageDailyTime: Math.round(statistics.averageDailyDuration / 60),
          categoryData: statistics.typeStatistics.map(stat => ({
            category: this.getCategoryName(stat.type),
            studyTime: Math.round(stat.totalDuration / 60),
            count: stat.count,
            percentage: Math.round((stat.totalDuration / statistics.totalDuration) * 100)
          })),
          exerciseStats: statistics.exerciseStatistics ? {
            totalExercises: statistics.exerciseStatistics.totalExercises,
            averageScore: statistics.exerciseStatistics.averageScore,
            totalQuestions: statistics.exerciseStatistics.totalQuestions,
            totalCorrect: statistics.exerciseStatistics.totalCorrect,
            accuracy: statistics.exerciseStatistics.accuracy
          } : null
        };

        // 存入缓存
        if (this.config.cacheEnabled) {
          this.saveToCache(cacheKey, formattedStats);
        }

        return formattedStats;
      }

      // 返回默认统计数据
      return this.getDefaultStatistics();
    } catch (error) {
      console.error('获取学习统计失败:', error);
      return this.getDefaultStatistics();
    }
  }

  // 获取记录标题
  getRecordTitle(record) {
    const typeNames = {
      vocabulary: '词语学习',
      literature: '古诗词学习',
      idiom: '熟语习语',
      exercise: '练习',
      pinyin: '拼音学习',
      correction: '文本纠错'
    };

    const baseTitle = typeNames[record.type] || '学习记录';

    if (record.content && record.content.title) {
      return `${baseTitle} - ${record.content.title}`;
    }

    return baseTitle;
  }

  // 获取分类名称
  getCategoryName(type) {
    const typeNames = {
      vocabulary: '词语学习',
      literature: '古诗词',
      idiom: '熟语习语',
      exercise: '练习',
      pinyin: '拼音',
      correction: '文本纠错'
    };

    return typeNames[type] || type;
  }

  // 格式化时长
  formatDuration(seconds) {
    const minutes = Math.floor(seconds / 60);
    const remainingSeconds = seconds % 60;

    if (minutes < 60) {
      return `${minutes}分${remainingSeconds > 0 ? remainingSeconds + '秒' : ''}`;
```

---

## 第 15 页

**文件名：src/services/studyRecordService.js（续）**

```javascript
    }

    const hours = Math.floor(minutes / 60);
    const remainingMinutes = minutes % 60;

    return `${hours}小时${remainingMinutes > 0 ? remainingMinutes + '分钟' : ''}`;
  }

  // 获取默认统计数据
  getDefaultStatistics() {
    return {
      totalStudyTime: 0,
      studyDays: 0,
      averageDailyTime: 0,
      categoryData: [],
      exerciseStats: {
        totalExercises: 0,
        averageScore: 0,
        totalQuestions: 0,
        totalCorrect: 0,
        accuracy: 0
      }
    };
  }

  // 缓存相关方法
  getFromCache(key) {
    const cachedItem = this.cache.get(key);
    if (!cachedItem) return null;

    const now = Date.now();
    if (now > cachedItem.expiry) {
      this.cache.delete(key);
      return null;
    }

    return cachedItem.data;
  }

  saveToCache(key, data, customTTL = null) {
    const expiry = Date.now() + (customTTL || this.config.cacheTTL);
    this.cache.set(key, { data, expiry });
  }

  clearCacheByPrefix(prefix) {
    for (let key of this.cache.keys()) {
      if (key.startsWith(prefix)) {
        this.cache.delete(key);
      }
    }
  }

  clearAllCache() {
    this.cache.clear();
  }

  // 清除缓存
  clearCache() {
    this.clearAllCache();
  }

  // 获取今日得分
  async getTodayScore() {
    try {
      // 获取今天的学习记录
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      const tomorrow = new Date(today);
      tomorrow.setDate(tomorrow.getDate() + 1);

      const params = {
        startDate: today.toISOString().split('T')[0],
        endDate: today.toISOString().split('T')[0],
        limit: 1000
      };

      const response = await api.get('/study/records', { params });

      if (response.success && response.data.length > 0) {
```

---

## 第 16 页

**文件名：src/services/studyRecordService.js（续）**

```javascript
        // 计算今日总得分
        const scores = response.data.filter(r => r.score !== null).map(r => r.score);
        if (scores.length > 0) {
          // 返回累加得分
          return scores.reduce((sum, score) => sum + score, 0);
        }
      }

      return 0;
    } catch (error) {
      console.error('获取今日得分失败:', error);
      return 0;
    }
  }

  // 获取总学习时长（分钟）
  async getTotalStudyTime() {
    try {
      const statistics = await this.getStudyStatistics(365); // 获取一年的数据
      return statistics.totalStudyTime || 0;
    } catch (error) {
      console.error('获取总学习时长失败:', error);
      return 0;
    }
  }

  // 获取已学习天数
  async getStudyDays() {
    try {
      const statistics = await this.getStudyStatistics(365);
      return statistics.studyDays || 0;
    } catch (error) {
      console.error('获取学习天数失败:', error);
      return 0;
    }
  }

  // 获取错题总数
  async getWrongCount() {
    try {
      // 获取所有练习记录
      const params = {
        limit: 10000
      };

      const response = await api.get('/study/records', { params });

      if (response.success && response.data.length > 0) {
        // 计算总错题数
        let wrongCount = 0;
        response.data.forEach(record => {
          if (record.totalQuestions && record.correctAnswers !== null) {
            wrongCount += (record.totalQuestions - record.correctAnswers);
          }
        });
        return wrongCount;
      }

      return 0;
    } catch (error) {
      console.error('获取错题数失败:', error);
      return 0;
    }
  }

  // 获取各模块学习进度
  async getProgressByType() {
    try {
```

---

## 第 17 页

**文件名：src/services/studyRecordService.js（续）**

```javascript
      // 获取所有学习记录
      const params = { limit: 10000 };
      const response = await api.get('/study/records', { params });

      const progressList = [
        { type: 'pinyin', name: '拼音掌握度', progress: 0 },
        { type: 'vocabulary', name: '词汇量', progress: 0 },
        { type: 'literature', name: '文学常识', progress: 0 },
        { type: 'idiom', name: '成语积累', progress: 0 }
      ];

      if (response.success && response.data.length > 0) {
        // 按类型分组计算
        const typeStats = {};
        response.data.forEach(record => {
          if (!typeStats[record.type]) {
            typeStats[record.type] = {
              totalQuestions: 0,
              correctAnswers: 0,
              count: 0
            };
          }
          typeStats[record.type].totalQuestions += record.totalQuestions || 0;
          typeStats[record.type].correctAnswers += record.correctAnswers || 0;
          typeStats[record.type].count += 1;
        });

        // 计算各类型进度
        progressList.forEach(item => {
          const stats = typeStats[item.type];
          if (stats && stats.totalQuestions > 0) {
            // 基于正确率计算进度，同时考虑学习次数
            const accuracy = (stats.correctAnswers / stats.totalQuestions) * 100;
            // 学习次数越多，基础进度越高
            const baseProgress = Math.min(50, stats.count * 5);
            // 综合得分
            item.progress = Math.min(100, Math.round(baseProgress + accuracy * 0.5));
          }
        });
      }

      return progressList;
    } catch (error) {
      console.error('获取学习进度失败:', error);
      return [
        { type: 'pinyin', name: '拼音掌握度', progress: 0 },
        { type: 'vocabulary', name: '词汇量', progress: 0 },
        { type: 'literature', name: '文学常识', progress: 0 },
        { type: 'idiom', name: '成语积累', progress: 0 }
      ];
    }
  }
```

---

## 第 18 页

**文件名：src/services/studyRecordService.js（续）**

```javascript
  // 获取首页所有统计数据
  async getHomeStatistics() {
    try {
      console.log('========== getHomeStatistics 开始 ==========');

      // 清除缓存，确保获取最新数据
      this.clearCache();

      // 一次性获取所有记录，避免多次查询
      const params = { limit: 10000 };
      console.log('请求参数:', params);
      const allRecordsResponse = await api.get('/study/records', { params });

      console.log('API响应:', allRecordsResponse);

      if (!allRecordsResponse.success) {
        console.error('获取学习记录失败');
        throw new Error('获取学习记录失败');
      }

      const allRecords = allRecordsResponse.data;
      console.log('获取到的记录数:', allRecords.length);

      // 计算今日得分
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      const tomorrow = new Date(today);
      tomorrow.setDate(tomorrow.getDate() + 1);

      const todayRecords = allRecords.filter(r => {
        const recordDate = new Date(r.createdAt);
        return recordDate >= today && recordDate < tomorrow;
      });

      const todayScore = todayRecords
        .filter(r => r.score !== null)
        .reduce((sum, r) => sum + r.score, 0);

      // 计算总学习时长（分钟）
      const totalStudyTime = Math.round(
        allRecords.reduce((sum, r) => sum + (r.duration || 0), 0) / 60
      );

      // 计算学习天数
      const uniqueDates = new Set(
        allRecords.map(r => new Date(r.createdAt).toDateString())
      );
      const studyDays = uniqueDates.size;

      // 计算错题总数
      const wrongCount = allRecords.reduce((total, record) => {
        if (record.totalQuestions && record.correctAnswers !== null) {
          return total + (record.totalQuestions - record.correctAnswers);
        }
        return total;
      }, 0);

      console.log('计算结果:');
      console.log('  今日得分:', todayScore);
      console.log('  错题数量:', wrongCount);
```

---

## 第 19 页

**文件名：src/services/studyRecordService.js（续）**

```javascript
      console.log('  总学习时长:', totalStudyTime, '分钟');
      console.log('  学习天数:', studyDays);

      // 计算各模块进度
      const progressList = [
        { type: 'pinyin', name: '拼音掌握度', progress: 0 },
        { type: 'vocabulary', name: '词汇量', progress: 0 },
        { type: 'literature', name: '文学常识', progress: 0 },
        { type: 'idiom', name: '成语积累', progress: 0 }
      ];

      const typeStats = {};
      allRecords.forEach(record => {
        if (!typeStats[record.type]) {
          typeStats[record.type] = {
            totalQuestions: 0,
            correctAnswers: 0,
            count: 0
          };
        }
        typeStats[record.type].totalQuestions += record.totalQuestions || 0;
        typeStats[record.type].correctAnswers += record.correctAnswers || 0;
        typeStats[record.type].count += 1;
      });

      progressList.forEach(item => {
        const stats = typeStats[item.type];
        if (stats && stats.totalQuestions > 0) {
          const accuracy = (stats.correctAnswers / stats.totalQuestions) * 100;
          const baseProgress = Math.min(50, stats.count * 5);
          item.progress = Math.min(100, Math.round(baseProgress + accuracy * 0.5));
        }
      });

      const result = {
        todayScore,
        errorCount: wrongCount,
        totalStudyTime,
        studyDays,
        progressList
      };

      console.log('最终返回结果:', result);

      // 缓存结果（1小时）
      const cacheKey = 'homeStatistics';
      this.saveToCache(cacheKey, result, 60 * 60 * 1000);

      return result;
    } catch (error) {
      console.error('获取首页统计失败:', error);
      return {
        todayScore: 0,
        errorCount: 0,
        totalStudyTime: 0,
        studyDays: 0,
        progressList: [
          { type: 'pinyin', name: '拼音掌握度', progress: 0 },
```

---

## 第 20 页

**文件名：src/services/studyRecordService.js（续）**

```javascript
          { type: 'vocabulary', name: '词汇量', progress: 0 },
          { type: 'literature', name: '文学常识', progress: 0 },
          { type: 'idiom', name: '成语积累', progress: 0 }
        ]
      };
    }
  }
}

// 创建单例实例
const studyRecordService = new StudyRecordService();

// 初始化服务
studyRecordService.init();

export { studyRecordService };
```

**文件名：src/services/aiChatService.js**

```javascript
// AI聊天服务 - 用于调用硅基流动的DeepSeek API
import api from './api';

class AIChatService {
  constructor() {
    // 服务配置
    this.config = {
      apiProvider: 'deepseek', // 服务提供商
      apiBaseUrl: 'https://api.deepseek.com/v1', // DeepSeek API基础URL
      timeout: 10000, // 请求超时时间（毫秒）
      cacheEnabled: true, // 是否启用缓存
      cacheTTL: 3600000, // 缓存有效期（毫秒）
      apiKey: import.meta.env.VITE_DEEPSEEK_API_KEY || '', // 从环境变量读取API密钥
      model: 'deepseek-chat', // 使用的模型
      maxTokens: 2000, // 最大生成长度
      temperature: 0.7, // 温度参数，控制生成文本的随机性
    };

    // 初始化缓存
    this.cache = new Map();
  }

  // 初始化服务
  init(apiKey = '') {
    console.log('AIChatService initialized');
    // 优先使用传入的apiKey，如果没有则使用环境变量中的值
    if (apiKey) {
      this.config.apiKey = apiKey;
    }
  }

  // 设置API密钥
  setApiKey(apiKey) {
    this.config.apiKey = apiKey;
    console.log('DeepSeek API key set');
  }

  // 调用DeepSeek API
  async callDeepSeekAPI(messages, options = {}) {
    try {
      // 检查API密钥是否设置
      if (!this.config.apiKey) {
        throw new Error('DeepSeek API key is not configured');
      }

      // 构建API请求参数
      const requestData = {
        model: options.model || this.config.model,
        messages: messages,
        max_tokens: options.maxTokens || this.config.maxTokens,
        temperature: options.temperature !== undefined ? options.temperature : this.config.temperature,
      };

      // 构建缓存键
      const cacheKey = `deepseek_${JSON.stringify(requestData)}`;

      // 检查缓存
      if (this.config.cacheEnabled) {
        const cachedResult = this.getFromCache(cacheKey);
        if (cachedResult) {
          console.log('Returning cached DeepSeek API response');
          return cachedResult;
        }
      }

      // 发送请求
      const response = await fetch(`${this.config.apiBaseUrl}/chat/completions`, {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${this.config.apiKey}`,
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(requestData),
      });

      // 检查响应状态
      if (!response.ok) {
        throw new Error(`DeepSeek API request failed with status: ${response.status}`);
      }

      // 解析响应
      const data = await response.json();

      // 检查响应数据格式
      if (!data.choices || data.choices.length === 0) {
        throw new Error('Invalid DeepSeek API response format');
      }

      // 获取响应内容
      const result = data.choices[0].message.content;

      // 存入缓存
      if (this.config.cacheEnabled) {
        this.saveToCache(cacheKey, result);
      }

      return result;
    } catch (error) {
```

---

## 第 21 页

**文件名：src/services/aiChatService.js（续）**

```javascript
      console.error('DeepSeek API call failed:', error);
      throw new Error(`DeepSeek API调用失败: ${error.message}`);
    }
  }

  // 与AI沟通学习情况
  async discussStudyProgress(studyData, question = '') {
    try {
      // 构建消息内容
      const messages = [
        {
          role: 'system',
          content: `你是一个专业的语文学习顾问，擅长分析学习数据并提供个性化建议。`
        },
        {
          role: 'user',
          content: this.buildStudyProgressPrompt(studyData, question)
        }
      ];

      // 调用API
      const response = await this.callDeepSeekAPI(messages, {
        temperature: 0.6, // 降低随机性，提高专业建议的准确性
      });

      return response;
    } catch (error) {
      console.error('Failed to discuss study progress:', error);
      throw error;
    }
  }

  // 构建学习进度讨论的提示词
  buildStudyProgressPrompt(studyData, question) {
    let prompt = `我的语文学习数据如下：\n`;

    // 添加学习统计数据
    if (studyData.statistics) {
      const stats = studyData.statistics;
      prompt += `- 总学习时长：${stats.totalStudyTime || 0}分钟\n`;
      prompt += `- 已学习词语：${stats.totalWordsLearned || 0}个\n`;
      prompt += `- 已完成练习：${stats.totalExercisesCompleted || 0}个\n`;
      prompt += `- 平均得分：${stats.averageScore || 0}分\n`;
      prompt += `- 完成率：${stats.completionRate || 0}%\n`;
      prompt += `- 连续学习天数：${stats.learningStreak || 0}天\n`;
    }

    // 添加分类学习数据
    if (studyData.categoryData && studyData.categoryData.length > 0) {
      prompt += `\n学习分类情况：\n`;
      studyData.categoryData.forEach(category => {
        prompt += `- ${category.category}：${category.studyTime || 0}分钟 (${category.percentage || 0}%)\n`;
      });
    }

    // 添加最近的学习记录
    if (studyData.recentRecords && studyData.recentRecords.length > 0) {
      prompt += `\n最近的学习记录：\n`;
      studyData.recentRecords.slice(0, 3).forEach(record => {
        prompt += `- ${record.title || '未命名练习'} (${record.studyDate || '日期不详'})：`;
        prompt += `${record.duration || 0}分钟，得分：${record.score || '未评分'}\n`;
      });
    }

    // 添加用户问题
    if (question) {
      prompt += `\n${question}`;
    } else {
      prompt += `\n请根据我的学习数据，分析我的学习情况，并提供个性化的学习建议。`;
    }

    return prompt;
  }

  // 缓存相关方法
  getFromCache(key) {
    const cachedItem = this.cache.get(key);
    if (!cachedItem) return null;

    const now = Date.now();
    if (now > cachedItem.expiry) {
      this.cache.delete(key);
      return null;
    }

    return cachedItem.data;
  }

  saveToCache(key, data) {
    const expiry = Date.now() + this.config.cacheTTL;
    this.cache.set(key, { data, expiry });
  }

  clearCacheByPrefix(prefix) {
    for (let key of this.cache.keys()) {
      if (key.startsWith(prefix)) {
        this.cache.delete(key);
      }
    }
  }

  clearAllCache() {
    this.cache.clear();
  }

  // 获取聊天历史
  async getChatHistory(limit = 50, offset = 0) {
    try {
      const response = await api.get('/chat/history', {
        params: { limit, offset }
      });

      if (response.success) {
        return response.data;
      }

      return [];
    } catch (error) {
      console.error('获取聊天历史失败:', error);
      return [];
    }
  }

  // 保存聊天消息
  async saveChatMessage(role, content) {
```

---

## 第 22 页

**文件名：src/services/aiChatService.js（续）**

```javascript
    try {
      const response = await api.post('/chat/message', {
        role,
        content
      });

      if (response.success) {
        return response.data;
      }

      return null;
    } catch (error) {
      console.error('保存聊天消息失败:', error);
      return null;
    }
  }

  // 批量保存聊天消息
  async saveChatMessages(messages) {
    try {
      const response = await api.post('/chat/messages', {
        messages
      });

      if (response.success) {
        return response.data;
      }

      return null;
    } catch (error) {
      console.error('批量保存聊天消息失败:', error);
      return null;
    }
  }

  // 清空聊天记录
  async clearChatHistory() {
    try {
      const response = await api.delete('/chat/clear');

      return {
        success: true,
        message: response.message || '清空成功'
      };
    } catch (error) {
      console.error('清空聊天记录失败:', error);
      return {
        success: false,
        message: error.response?.data?.message || '清空失败'
      };
    }
  }

  // 发送消息并自动保存聊天记录
  async sendMessage(userMessage, conversationHistory = []) {
    try {
      // 保存用户消息
      await this.saveChatMessage('user', userMessage);

      // 构建完整的消息历史
      const messages = [
        {
          role: 'system',
          content: '你是一个专业的语文学习助手，专门帮助体育生提高语文水平。请用简洁明了的语言回答问题，并提供实用的学习建议。'
        },
        ...conversationHistory,
        {
          role: 'user',
          content: userMessage
        }
      ];

      // 调用 DeepSeek API
      const aiResponse = await this.callDeepSeekAPI(messages);

      // 保存 AI 回复
      await this.saveChatMessage('assistant', aiResponse);

      return aiResponse;
    } catch (error) {
      console.error('发送消息失败:', error);
      throw error;
    }
  }
}

// 创建单例实例
const aiChatService = new AIChatService();

// 初始化服务
aiChatService.init();

export { aiChatService };
```

**文件名：src/pages/Home.jsx**

```javascript
import React, { useState, useEffect } from 'react'
import { Card, Row, Col, Statistic, Button, Avatar, Badge, Tabs, Spin, Tag } from 'antd'
import { FileTextOutlined, AudioOutlined, HighlightOutlined, BookOutlined, LayoutOutlined, StarOutlined, TrophyOutlined, ClockCircleOutlined, ExclamationCircleOutlined, RobotOutlined, CalendarOutlined, EditOutlined } from '@ant-design/icons'
import { useNavigate, Link } from 'react-router-dom'
import { authService } from '../services/authService'
import { studyRecordService } from '../services/studyRecordService'
import api from '../services/api'

const { TabPane } = Tabs

const Home = () => {
  const [userInfo, setUserInfo] = useState(null)
  const [loading, setLoading] = useState(true)
  const [statsLoading, setStatsLoading] = useState(true)
  const [currentTime, setCurrentTime] = useState(new Date())

  const [studyStats, setStudyStats] = useState({
    todayScore: 0,
```

---

## 第 23 页

**文件名：src/pages/Home.jsx（续）**

```javascript
    errorCount: 0,
    totalStudyTime: 0,
    studyDays: 0
  })

  const [questionStats, setQuestionStats] = useState({})

  const [recommendList, setRecommendList] = useState([
    {
      id: 1,
      title: '汉字拼音练习',
      description: '练习常用汉字的拼音读音',
      type: 'pinyin',
      isNew: false,
      icon: <AudioOutlined />,
      path: '/pinyin'
    },
    {
      id: 2,
      title: '错别字纠错',
      description: '智能识别并纠正错别字',
      type: 'correction',
      isNew: true,
      icon: <HighlightOutlined />,
      path: '/correction'
    },
    {
      id: 3,
      title: '古诗词赏析',
      description: '学习经典古诗词',
      type: 'poetry',
      isNew: false,
      icon: <BookOutlined />,
      path: '/literature'
    }
  ])

  // 定义所有模块的配置
  const allModulesConfig = {
    pinyin: {
      title: '拼音学习',
      description: '汉字转拼音\n语音评测',
      icon: <AudioOutlined />,
      path: '/pinyin'
    },
    vocabulary: {
      title: '词汇学习',
      description: '词语查询\n语义理解',
      icon: <FileTextOutlined />,
      path: '/vocabulary'
    },
    literature: {
      title: '古诗词',
      description: '古诗词学习\n名句默写',
      icon: <BookOutlined />,
      path: '/literature'
    },
    idiom: {
      title: '成语熟语',
      description: '成语学习\n谚语理解',
      icon: <StarOutlined />,
      path: '/idiom'
    },
    correction: {
      title: '病句修改',
      description: '病句辨析\n智能纠错',
      icon: <HighlightOutlined />,
      path: '/correction'
    },
    grammar: {
      title: '语法知识',
      description: '语法练习\n句子分析',
      icon: <LayoutOutlined />,
      path: '/exercise'
    },
    reading: {
      title: '阅读理解',
      description: '文章阅读\n理解分析',
      icon: <FileTextOutlined />,
      path: '/exercise'
    },
    comprehension: {
      title: '综合练习',
      description: '综合能力\n全面测试',
      icon: <LayoutOutlined />,
      path: '/exercise'
    }
  }

  const [moduleList, setModuleList] = useState([])

  // 获取用户信息
  useEffect(() => {
    const fetchUserInfo = async () => {
      try {
        const user = authService.getStoredUser();
        if (user) {
          setUserInfo({
            name: user.nickname || user.username,
            level: '初级',
            avatar: user.avatar || `https://api.dicebear.com/7.x/avataaars/svg?seed=${user.username}`
          });
        }
      } catch (error) {
        console.error('获取用户信息失败:', error);
      } finally {
        setLoading(false);
      }
    };

    fetchUserInfo();
  }, []);

  // 更新当前时间
  useEffect(() => {
    const timer = setInterval(() => {
      setCurrentTime(new Date());
    }, 1000);

    return () => clearInterval(timer);
  }, []);

  // 获取学习统计数据
  useEffect(() => {
    const fetchStatistics = async () => {
      try {
        console.log('========== Home.jsx - 开始获取统计数据 ==========');
        setStatsLoading(true);
        const stats = await studyRecordService.getHomeStatistics();
        console.log('Home.jsx - 获取到的统计数据:', stats);
        setStudyStats({
```

---

## 第 24 页

**文件名：src/pages/Home.jsx（续）**

```javascript
          todayScore: stats.todayScore,
          errorCount: stats.errorCount,
          totalStudyTime: stats.totalStudyTime,
          studyDays: stats.studyDays
        });
        console.log('Home.jsx - 状态已更新, studyStats:', {
          todayScore: stats.todayScore,
          errorCount: stats.errorCount,
          totalStudyTime: stats.totalStudyTime,
          studyDays: stats.studyDays
        });
      } catch (error) {
        console.error('获取统计数据失败:', error);
      } finally {
        setStatsLoading(false);
      }
    };

    fetchStatistics();
  }, []);

  // 获取题目统计
  useEffect(() => {
    const fetchQuestionStats = async () => {
      try {
        const response = await api.get('/questions/stats');
        if (response.success) {
          setQuestionStats(response.data);

          // 动态生成模块列表
          const modules = Object.entries(response.data)
            .filter(([type, count]) => count > 0 && allModulesConfig[type])
            .map(([type, count]) => ({
              id: type,
              title: allModulesConfig[type].title,
              description: allModulesConfig[type].description,
              icon: allModulesConfig[type].icon,
              path: allModulesConfig[type].path,
              type: type
            }));
          setModuleList(modules);
        }
      } catch (error) {
        console.error('获取题目统计失败:', error);
      }
    };

    fetchQuestionStats();
  }, []);

  // 格式化学习时间
  const formatStudyTime = (minutes) => {
    const hours = Math.floor(minutes / 60);
    const mins = minutes % 60;
    if (hours > 0) {
      return `${hours}小时${mins > 0 ? mins + '分钟' : ''}`;
    }
    return `${mins}分钟`;
  };

  return (
    <div className="home-container">
      {/* 第一行：用户信息卡片和日期时间卡片 */}
      <Row gutter={[16, 16]} style={{ marginBottom: 24 }}>
        <Col xs={24} sm={24} md={12}>
          <Card>
            <div style={{ textAlign: 'center' }}>
              <Avatar
                size={80}
                src={userInfo?.avatar}
                style={{ marginBottom: 16 }}
              >
                {userInfo?.name?.charAt(0)}
              </Avatar>
              <h3>{userInfo?.name || '加载中...'}</h3>
              <Badge
                count={userInfo?.level || '初级'}
                style={{ backgroundColor: '#52c41a' }}
              />
              <p style={{ marginTop: 8, color: '#666' }}>
                {statsLoading ? (
                  <Spin size="small" />
                ) : (
                  `已坚持学习 ${studyStats.studyDays} 天`
                )}
              </p>
            </div>
          </Card>
        </Col>

        {/* 日期时间卡片 */}
        <Col xs={24} sm={24} md={12}>
          <Card>
```

---

## 第 25 页

**文件名：src/pages/Home.jsx（续）**

```javascript
            <div style={{ textAlign: 'center' }}>
              <div style={{ fontSize: 48, color: '#1890ff', marginBottom: 16 }}>
                <CalendarOutlined />
              </div>
              <div style={{ fontSize: 24, fontWeight: 'bold', marginBottom: 8 }}>
                {currentTime.toLocaleDateString('zh-CN', {
                  month: 'long',
                  day: 'numeric'
                })}
              </div>
              <div style={{ fontSize: 16, color: '#666', marginBottom: 8 }}>
                {currentTime.toLocaleDateString('zh-CN', {
                  weekday: 'long'
                })}
              </div>
              <div style={{ fontSize: 14, color: '#666', marginBottom: 4 }}>
                {currentTime.getFullYear()}年
              </div>
              <div style={{ fontSize: 20, fontWeight: 'bold', color: '#1890ff' }}>
                {currentTime.toLocaleTimeString('zh-CN', {
                  hour: '2-digit',
                  minute: '2-digit',
                  second: '2-digit'
                })}
              </div>
            </div>
          </Card>
        </Col>
      </Row>

      {/* 第二行：学习统计卡片 */}
      <Row gutter={[16, 16]} style={{ marginBottom: 24 }}>
        <Col xs={24} sm={24} md={24}>
          <Row gutter={[16, 16]}>
            <Col xs={12} sm={6}>
              <Card>
                <Statistic
                  title="今日得分"
                  value={studyStats.todayScore}
                  suffix="分"
                  valueStyle={{ color: '#3f8600' }}
                  prefix={<TrophyOutlined />}
                  loading={statsLoading}
                />
              </Card>
            </Col>
            <Col xs={12} sm={6}>
              <Card>
                <Statistic
                  title="总学习时间"
                  value={formatStudyTime(studyStats.totalStudyTime)}
                  valueStyle={{ color: '#1890ff' }}
                  prefix={<ClockCircleOutlined />}
                  loading={statsLoading}
                />
              </Card>
            </Col>
            <Col xs={12} sm={6}>
              <Card>
                <Statistic
                  title="已学习天数"
                  value={studyStats.studyDays}
                  suffix="天"
                  valueStyle={{ color: '#722ed1' }}
                  prefix={<CalendarOutlined />}
                  loading={statsLoading}
                />
              </Card>
            </Col>
            <Col xs={12} sm={6}>
              <Card>
                <Statistic
                  title="错题数量"
                  value={studyStats.errorCount}
                  suffix="个"
                  valueStyle={{ color: '#cf1322' }}
                  prefix={<ExclamationCircleOutlined />}
                  loading={statsLoading}
                />
              </Card>
            </Col>
          </Row>
        </Col>
      </Row>
```

---

## 第 26 页

**文件名：src/pages/Home.jsx（续）**

```javascript
      {/* 推荐学习 */}
      <Card
        title={
          <span>
            推荐学习
            <span style={{ fontSize: 14, fontWeight: 'normal', marginLeft: 10, color: '#666' }}>
              {new Date().toLocaleDateString('zh-CN', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'long'
              })}
            </span>
          </span>
        }
        style={{ marginBottom: 24 }}
      >
        <Row gutter={[16, 16]}>
          {recommendList.map((item) => (
            <Col xs={24} sm={8} key={item.id}>
              <Card
                hoverable
                style={{ textAlign: 'center', height: '100%' }}
                bodyStyle={{ padding: 24 }}
              >
                <div style={{ fontSize: 32, color: '#1890ff', marginBottom: 16 }}>
                  {item.icon}
                </div>
                <h4>{item.title}</h4>
                <p style={{ color: '#666', marginBottom: 16 }}>{item.description}</p>
                {item.isNew && (
                  <Badge
                    count="新"
                    style={{ backgroundColor: '#52c41a', marginBottom: 16 }}
                  />
                )}
                <br />
                <Button
                  type="primary"
                  icon={<RobotOutlined />}
                  onClick={() => window.location.href = item.path}
                >
                  开始学习
                </Button>
              </Card>
            </Col>
          ))}
        </Row>
      </Card>

      {/* 模拟考试 */}
      <Card title="模拟考试" style={{ marginBottom: 24 }}>
        <Row gutter={[16, 16]}>
          <Col xs={24} sm={12} md={8}>
            <Card
              hoverable
              style={{ textAlign: 'center', height: '100%' }}
              bodyStyle={{ padding: 24 }}
              onClick={() => window.location.href = '/mock-exam'}
            >
              <div style={{ fontSize: 48, color: '#fa8c16', marginBottom: 16 }}>
                <TrophyOutlined />
              </div>
              <h3>开始模拟考试</h3>
              <p style={{ color: '#666' }}>
                检验学习成果<br />
                随机抽取题目组卷<br />
                支持多种题型选择
              </p>
              <Button type="primary" size="large" icon={<EditOutlined />}>
                进入考场
              </Button>
            </Card>
          </Col>
          <Col xs={24} sm={12} md={16}>
            <div style={{ padding: '20px 0' }}>
              <h4>模拟考试说明</h4>
              <ul style={{ lineHeight: '1.8' }}>
                <li>可自定义考试时长：30/60/90/120分钟</li>
                <li>可自定义题目数量：20/50/100题</li>
                <li>可按题型筛选：拼音、词汇、古诗词等</li>
                <li>考试结束自动评分，查看详细解析</li>
                <li>考试成绩自动保存到学习记录</li>
              </ul>
              <div style={{ marginTop: 20 }}>
                <Tag color="blue">限时考试</Tag>
                <Tag color="green">自动评分</Tag>
                <Tag color="orange">详细解析</Tag>
              </div>
            </div>
          </Col>
        </Row>
      </Card>
```

---

## 第 27 页

**文件名：src/pages/Home.jsx（续）**

```javascript
      {/* 学习模块 */}
      <Card title="学习模块">
        <Row gutter={[16, 16]}>
          {moduleList.map((item) => (
            <Col xs={24} sm={8} md={4} key={item.id}>
              <Card
                hoverable
                style={{ textAlign: 'center', height: '100%' }}
                bodyStyle={{ padding: 16 }}
                onClick={() => window.location.href = item.path}
              >
                <div style={{ fontSize: 28, color: '#1890ff', marginBottom: 8 }}>
                  {item.icon}
                </div>
                <h5>{item.title}</h5>
                <p style={{ fontSize: 12, color: '#666', whiteSpace: 'pre-line' }}>
                  {item.description}
                </p>
                <Badge count={questionStats[item.type]} style={{ backgroundColor: '#52c41a' }} />
              </Card>
            </Col>
          ))}
        </Row>
      </Card>
    </div>
  )
}

export default Home
```

**文件名：server/index.js**

```javascript
require('dotenv').config();
const express = require('express');
const cors = require('cors');
const path = require('path');
const { sequelize } = require('./models');

// 导入路由
const authRoutes = require('./routes/auth');
const chatRoutes = require('./routes/chat');
const studyRoutes = require('./routes/study');
const questionRoutes = require('./routes/questions');

const app = express();
const PORT = process.env.PORT || 3001;

// 中间件
app.use(cors());
app.use(express.json({ limit: '10mb' }));
app.use(express.urlencoded({ extended: true, limit: '10mb' }));

// 日志中间件
app.use((req, res, next) => {
  console.log(`${new Date().toISOString()} - ${req.method} ${req.path}`);
  next();
});

// API 路由
app.use('/api/auth', authRoutes);
app.use('/api/chat', chatRoutes);
app.use('/api/study', studyRoutes);
app.use('/api/questions', questionRoutes);

// 健康检查接口
app.get('/api/health', (req, res) => {
  res.json({
    success: true,
    message: 'Server is running',
    timestamp: new Date().toISOString()
  });
});

// 404 处理
app.use((req, res) => {
  res.status(404).json({
    success: false,
    message: '接口不存在'
  });
});

// 全局错误处理
app.use((err, req, res, next) => {
  console.error('服务器错误:', err);
  res.status(500).json({
    success: false,
    message: '服务器内部错误'
  });
});
```

---

## 第 28 页

**文件名：server/index.js（续）**

```javascript
// 数据库同步和服务器启动
async function startServer() {
  try {
    // 同步数据库
    await sequelize.authenticate();
    console.log('数据库连接成功');

    // 创建表（如果不存在）
    await sequelize.sync({ force: false });
    console.log('数据库同步成功');

    // 启动服务器
    app.listen(PORT, '0.0.0.0', () => {
      console.log(`服务器运行在 http://localhost:${PORT}`);
      console.log(`服务器监听所有网络接口 (0.0.0.0:${PORT})`);
      console.log('API 端点：');
      console.log('  - POST /api/auth/register - 用户注册');
      console.log('  - POST /api/auth/login - 用户登录');
      console.log('  - GET  /api/auth/profile - 获取用户信息');
      console.log('  - PUT  /api/auth/profile - 更新用户信息');
      console.log('  - GET  /api/chat/history - 获取聊天历史');
      console.log('  - POST /api/chat/message - 保存聊天消息');
      console.log('  - GET  /api/study/records - 获取学习记录');
      console.log('  - POST /api/study/record - 添加学习记录');
      console.log('  - GET  /api/study/statistics - 获取学习统计');
      console.log('  - GET  /api/questions - 获取题目列表');
      console.log('  - GET  /api/questions/random - 随机获取题目');
      console.log('  - GET  /api/questions/type/:type - 按类型获取题目');
      console.log('  - GET  /api/questions/year/:year - 按年份获取题目');
    });
  } catch (error) {
    console.error('启动服务器失败:', error);
    process.exit(1);
  }
}

// 优雅关闭
process.on('SIGINT', async () => {
  console.log('\n正在关闭服务器...');
  await sequelize.close();
  console.log('数据库连接已关闭');
  process.exit(0);
});

startServer();
```

**文件名：server/models/index.js**

```javascript
const sequelize = require('../config/database');
const User = require('./User');
const ChatHistory = require('./ChatHistory');
const StudyRecord = require('./StudyRecord');
const Question = require('./Question');

// 定义模型之间的关联
User.hasMany(ChatHistory, { foreignKey: 'userId', as: 'chatHistories' });
ChatHistory.belongsTo(User, { foreignKey: 'userId', as: 'user' });

User.hasMany(StudyRecord, { foreignKey: 'userId', as: 'studyRecords' });
StudyRecord.belongsTo(User, { foreignKey: 'userId', as: 'user' });

module.exports = {
  sequelize,
  User,
  ChatHistory,
  StudyRecord,
  Question
};
```

**文件名：server/models/User.js**

```javascript
module.exports = (sequelize, DataTypes) => {
  const User = sequelize.define('User', {
    id: {
      type: DataTypes.INTEGER,
      primaryKey: true,
      autoIncrement: true
    },
    username: {
      type: DataTypes.STRING(50),
      allowNull: false,
      unique: true
    },
    password: {
      type: DataTypes.STRING(255),
      allowNull: false
    },
    nickname: {
      type: DataTypes.STRING(50),
      defaultValue: ''
    },
```

---

## 第 29 页

**文件名：server/models/User.js（续）**

```javascript
    avatar: {
      type: DataTypes.STRING(255),
      defaultValue: ''
    },
    email: {
      type: DataTypes.STRING(100),
      defaultValue: ''
    },
    phone: {
      type: DataTypes.STRING(20),
      defaultValue: ''
    },
    gender: {
      type: DataTypes.ENUM('male', 'female', 'other'),
      defaultValue: 'other'
    },
    birthday: {
      type: DataTypes.DATE,
      allowNull: true
    },
    school: {
      type: DataTypes.STRING(100),
      defaultValue: ''
    },
    grade: {
      type: DataTypes.STRING(20),
      defaultValue: ''
    },
    interests: {
      type: DataTypes.TEXT,
      defaultValue: ''
    },
    bio: {
      type: DataTypes.TEXT,
      defaultValue: ''
    }
  }, {
    tableName: 'Users',
    timestamps: true,
    indexes: [
      {
        unique: true,
        fields: ['username']
      },
      {
        unique: true,
        fields: ['email']
      }
    ]
  });

  return User;
};
```

**文件名：server/models/StudyRecord.js**

```javascript
module.exports = (sequelize, DataTypes) => {
  const StudyRecord = sequelize.define('StudyRecord', {
    id: {
      type: DataTypes.INTEGER,
      primaryKey: true,
      autoIncrement: true
    },
    userId: {
      type: DataTypes.INTEGER,
      allowNull: false,
      references: {
        model: 'Users',
        key: 'id'
      }
    },
    type: {
      type: DataTypes.STRING(50),
      allowNull: false
    },
    content: {
      type: DataTypes.TEXT,
      allowNull: false
    },
    duration: {
      type: DataTypes.INTEGER,
      defaultValue: 0
    },
    score: {
      type: DataTypes.INTEGER,
      allowNull: true
    },
    totalQuestions: {
      type: DataTypes.INTEGER,
      defaultValue: 0
    },
    correctAnswers: {
      type: DataTypes.INTEGER,
      defaultValue: 0
    }
  }, {
    tableName: 'StudyRecord',
    timestamps: true,
    indexes: [
      { fields: ['userId', 'type'] },
      { fields: ['userId', 'createdAt'] }
    ]
  });

  return StudyRecord;
};
```

**文件名：server/models/Question.js**

```javascript
module.exports = (sequelize, DataTypes) => {
  const Question = sequelize.define('Question', {
    id: {
      type: DataTypes.INTEGER,
      primaryKey: true,
      autoIncrement: true
    },
    type: {
      type: DataTypes.STRING(50),
      allowNull: false
    },
    year: {
      type: DataTypes.STRING(10),
      defaultValue: ''
    },
    source: {
      type: DataTypes.STRING(100),
      defaultValue: ''
    },
    content: {
      type: DataTypes.TEXT,
      allowNull: false
    },
    options: {
      type: DataTypes.TEXT,
      allowNull: true
    },
```

---

## 第 30 页

**文件名：server/models/Question.js（续）**

```javascript
    answer: {
      type: DataTypes.STRING(10),
      allowNull: false
    },
    explanation: {
      type: DataTypes.TEXT,
      defaultValue: ''
    },
    difficulty: {
      type: DataTypes.ENUM('easy', 'medium', 'hard'),
      defaultValue: 'medium'
    },
    questionNumber: {
      type: DataTypes.STRING(20),
      defaultValue: ''
    },
    tags: {
      type: DataTypes.TEXT,
      defaultValue: ''
    }
  }, {
    tableName: 'Questions',
    timestamps: true,
    indexes: [
      { fields: ['type'] },
      { fields: ['year'] },
      { fields: ['difficulty'] },
      { fields: ['type', 'year'] }
    ]
  });

  return Question;
};
```

**文件名：server/routes/auth.js**

```javascript
const express = require('express');
const bcrypt = require('bcryptjs');
const jwt = require('jsonwebtoken');
const { User } = require('../models');
const authMiddleware = require('../middleware/auth');

const router = express.Router();

// 用户注册
router.post('/register', async (req, res) => {
  try {
    const { username, password, nickname, email } = req.body;

    // 验证必填字段
    if (!username || !password) {
      return res.status(400).json({
        success: false,
        message: '用户名和密码不能为空'
      });
    }

    // 检查用户名是否已存在
    const existingUser = await User.findOne({
      where: { username }
    });

    if (existingUser) {
      return res.status(400).json({
        success: false,
        message: '用户名已存在'
      });
    }

    // 检查邮箱是否已存在（如果提供了邮箱）
    if (email) {
      const existingEmail = await User.findOne({
        where: { email }
      });

      if (existingEmail) {
        return res.status(400).json({
          success: false,
          message: '邮箱已被注册'
        });
      }
    }

    // 加密密码
    const saltRounds = 10;
    const hashedPassword = await bcrypt.hash(password, saltRounds);

    // 创建用户
    const user = await User.create({
      username,
      password: hashedPassword,
      nickname: nickname || username,
      email
    });

    // 生成 JWT token
    const token = jwt.sign(
      { userId: user.id },
      process.env.JWT_SECRET || 'your-secret-key',
      { expiresIn: '7d' }
    );

    // 返回用户信息（不包含密码）
    const userResponse = {
      id: user.id,
      username: user.username,
      nickname: user.nickname,
      email: user.email,
      avatar: user.avatar,
      createdAt: user.createdAt
    };

    res.status(201).json({
      success: true,
      message: '注册成功',
      token,
      user: userResponse
    });
  } catch (error) {
    console.error('注册错误:', error);
    res.status(500).json({
      success: false,
      message: '注册失败，请稍后重试'
    });
  }
});
```

---

**（前30页结束，共1500行源代码）**
